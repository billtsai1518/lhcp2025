!function(){const e=$T.domain("ravem"),t=function(){const t={connected:{icon:"x",tooltip:e.gettext("Disconnect {0} from the videoconference room {3}"),action:"disconnect",handler:function(t,n){const r=n.data("roomName");o(t,n,{old:"connected",new:"disconnected",error:"errorDisconnect",wait:"waitingDisconnect"},["already-disconnected"],{alreadyConnected:e.gettext("Would you like to force the room {0} to disconnect?").format(r),error:e.gettext("The room {0} might already be disconnected or connected to another videoconference room").format(r)},(function(e){return!1===e.connected}))}},disconnected:{icon:"video",tooltip:e.gettext("Connect {0} to the videoconference room {1}"),action:"connect",handler:function(t,n){const r=n.data("roomName"),c=n.data("vcRoomName");o(t,n,{old:"disconnected",new:"connected",error:"errorConnect",wait:"waitingConnect"},["already-connected"],{alreadyConnected:e.gettext("Would you like to force the room {0} to connect to your videoconference room ({1}) ?").format(r,c),error:e.gettext("The room {0} might already be connected to another videoconference room").format(r)},(function(e){return e.success}))}},errorConnect:{tooltip:e.gettext("Unable to connect<br>{2}Please wait a moment and refresh the page to try again."),tooltipType:"error",icon:"icon-warning"},errorDisconnect:{tooltip:e.gettext("Unable to disconnect<br>{2}Please wait a moment and refresh the page to try again."),tooltipType:"error",icon:"icon-warning"},errorStatus:{tooltip:e.gettext("Unable to contact the room.<br>{2}Please wait a moment and refresh the page to try again."),tooltipType:"error",icon:"icon-warning"},waitingConnect:{icon:"icon-spinner",tooltip:e.gettext("Connecting {0} to the videoconference room {1}")},waitingDisconnect:{icon:"icon-spinner",tooltip:e.gettext("Disconnecting {0} from the videoconference room {1}")},waitingStatus:{icon:"icon-spinner",tooltip:e.gettext("Waiting for information about {0}")},unsupported:{icon:"icon-warning",tooltip:e.gettext("Unsupported provider: {2}")}};function o(t,r,c,s,d,l){const u=r.data("roomName");if(t.success){let e=RavemPlugin.polling.limit;window.setTimeout((function t(){e?a(r).fail((function(o){e--,e?window.setTimeout(t,RavemPlugin.polling.interval):n(r,c.error,o.message||d.error)})).done((function(o){if(o.success&&l(o))n(r,c.new);else{if(e--,!e)return void n(r,c.error,o.message||d.error);window.setTimeout(t,RavemPlugin.polling.interval)}})):n(r,c.error)}),RavemPlugin.polling.interval)}else~_.indexOf(s,t.reason)?n(r,c.new):"connected-other"===t.reason?new ConfirmPopup(e.gettext("{0} already connected").format(u),[t.message.replace("\n","<br>"),d.alreadyConnected].join("<br>"),(function(e){n(r,c.old),e&&i(r,c.wait,!0).always((function(e){o(e,r,c,s,d,l)}))})).open():n(r,c.error,t.message)}function n(e,o,n="",r=""){e.data("state",o);const c=e.data("roomName"),i=e.data("vcRoomName"),a=`<i class="icon ${t[o].icon}"></i> ${c}`;e.html(a),e.toggleClass("disabled",!t[o].action),n=n?`${n}<br>`:"";const s={content:t[o].tooltip.format(c,i,n,r),position:{my:"top center",at:"bottom center"},show:"mouseover",hide:{event:"mouseout",leave:!1,fixed:!0,delay:500}};"tooltipType"in t[o]&&(s.style={classes:`qtip-${t[o].tooltipType}`}),e.qtip("destroy",!0),e.qtip(s)}function r(o){o.preventDefault();const n=$(this);if(!n.hasClass("disabled"))switch(n.data("state")){case"connected":i(n,"waitingDisconnect").always((function(e){t.connected.handler(e,n)}));break;case"disconnected":var r=$T.gettext("Ready to join the conference room?");confirmPrompt(r).then((function(){i(n,"waitingConnect").always((function(e){t.disconnected.handler(e,n)}))}));break;default:new ErrorPopup(e.gettext("Something went wrong."),[e.gettext("Unknown error")],e.gettext("Please refresh the page and try again.")).open()}}function c(t,o,r,c){c&&n(t,c);const i=$.Deferred();return $.ajax({type:o,url:r,error:function(t){let o;try{o=JSON.parse(t.responseText).error.message}catch(t){o=e.gettext("unknown error")}i.reject({success:!1,message:o})},success:function(e){i.resolve(e)}}),i.promise()}function i(e,o,n){n=n||!1;const r=e.data("state");let i=e.data(`${t[r].action}Url`);return n&&(i=build_url(i,{force:"1"})),c(e,"POST",i,o)}function a(e,t){return c(e,"GET",e.data("statusUrl"),t)}return function(e){return e.on("click",r),a(e,"waitingStatus").fail((function(t){n(e,"errorStatus",t.message)})).done((function(t){if(!t.success)return void n(e,"unsupported"===t.reason?t.reason:"errorStatus",t.message);const o=t.connected;n(e,o?"connected":"disconnected","",t.vc_room_id)})),e}}();$(document).ready((function(){$(".js-ravem-button").each((function(){t($(this))}))}))}();
//# sourceMappingURL=main.32f8c13d.bundle.js.map